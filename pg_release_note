PostgreSQL 12.7 发布说明
发布日期：2021 年 5 月 13 日

此版本包含从 12.6 修订版的多项修复。如需了解 12.x 主要版本中的新增功能，请参阅 E.23 节。

运行 12.x 版本的用户无需执行转储/恢复操作。如果您从 12.6 之前的版本升级，请参阅 E.17 节。

修复列表
防止数组下标计算中的整数溢出
修复了数组代码未能检测下标加长度溢出整数的情况，这可能导致后续内存覆盖及程序崩溃（CVE-2021-32027）。

修复目标列包含“无用列”的处理
当 INSERT ... ON CONFLICT ... UPDATE 包含多列子查询时，可能导致临时列未正确处理，引发数据类型不匹配或崩溃（CVE-2021-32028）。

跨分区更新的返回值计算修正
对涉及不同分区表结构的行移动，返回值计算可能出错或引发错误，尤其是在连接操作存在时（CVE-2021-32029）。

分区表约束属性调整的修复
修正了 ALTER TABLE ... ALTER CONSTRAINT 无法正确应用到分区表子表的错误。更新后可以通过执行相应命令修复问题。

修复子表继承中生成列的行为
要求子表继承父表时，生成列的定义方式必须一致。

禁止将标识列标记为可为空
GENERATED ... AS IDENTITY 隐含 NOT NULL，因此明确禁止将其设置为 NULL。

优化角色和数据库设置参数
允许 ALTER ROLE/DATABASE ... SET 命令设置参数（如 roles 和 temp_buffers），并避免因检查过于严格而导致的命令失败。

修复并发索引重建的统计目标问题
确保 REINDEX CONCURRENTLY 操作后索引的统计目标正确保留。

修复触发器中保存元组的内存释放问题
修复了某些情况下 AFTER 触发器导致的崩溃问题。

禁用通过快速路径调用窗口函数的可能性
禁止通过“快速路径”协议调用窗口函数或存储过程以避免崩溃。

改进 pg_identify_object_as_address() 支持事件触发器
增强了函数的灵活性。

修复负间隔下 Roman 格式化月份的行为
防止使用 to_char() 时因负值引发崩溃。

解决 BRIN 索引中可能的越界问题
避免非 2 的幂次的页面范围大小在位图扫描中引发的文件错误。

修复在恢复未提交的双阶段事务时的时间线变更问题
防止时间线 ID 出现不一致，导致服务器重启失败。

改进 Standby 模式下的锁释放逻辑
在关闭备用服务器时确保锁正确释放。

影响评估
主要修复了安全性和稳定性问题：对数组下标、分区表操作、触发器和索引相关问题进行修复。
少量行为更改：如标识列 NULL 的处理和子表生成列的继承行为。
建议检查：逻辑复制、分区表复杂操作、并发索引处理等场景的影响。

以下是 PostgreSQL 12.8 的中文更新说明翻译：

---

**PostgreSQL 12.8**  
**发布日期**：2021 年 8 月 12 日  

此版本包含从 12.7 改进而来的修复。有关 PostgreSQL 12 主要版本的新功能，请参阅[第 E.23 节](https://www.postgresql.org/docs/12/release-12.html)。  

对于运行 12.X 的用户，无需进行数据导出/恢复。  
但是，如果您从 12.6 之前的版本升级，请参阅[第 E.17 节](https://www.postgresql.org/docs/12/release-12.html)。  

### 主要修复和改进

1. **修复投影步骤重复应用的错误规划**  
   修复了在规划器中，当两个 `ProjectionPaths` 叠加使用时可能生成错误计划的问题。此问题可能在并行排序操作或其他场景中触发，导致崩溃或错误查询结果，甚至可能泄露服务器内存内容。（CVE-2021-3677）

2. **更彻底地禁用 SSL 重新协商**  
   尽管早已禁用 SSL 重新协商，服务器仍可能响应客户端发起的重新协商请求，这可能导致服务器崩溃（参见 OpenSSL 漏洞 CVE-2021-3449）。在 OpenSSL 1.1.0h 及以上版本中彻底禁用该功能。

3. **在过程内的提交或回滚后恢复 Portal 层的快照**  
   修复了在过程内调用 `COMMIT/ROLLBACK` 后尝试获取 `TOAST` 值时可能出现的错误，例如“没有已知的快照”或“丢失的块编号 0”。

4. **避免游标在读取非稳定查询输出时的异常行为**  
   改进了对非滚动（`NO SCROLL`）游标的处理，仅存储未读取部分的查询输出，避免与非稳定查询的错误交互。

5. **其他关键修复**  
   - 拒绝 `SELECT ... GROUP BY GROUPING SETS (()) FOR UPDATE` 的查询，因为这会导致空指针问题。
   - 修复 `WITH` 查询仅重写为 `NOTIFY` 时导致的崩溃问题。
   - 修复数字运算中涉及非常大数值或除零情况下的错误行为。
   - 改进了触发器在分区表中启用状态的克隆逻辑。

6. **性能和稳定性增强**  
   - 修复了因索引状态标志非事务性更新可能导致的故障。
   - 改进了并行 B 树索引构建的排序进度报告。
   - 解决了逻辑解码和复制协议中的潜在死锁和内存泄漏问题。

7. **工具和客户端改进**  
   - 修复了 `pg_dump` 对分区表触发器启用状态的处理不一致性问题。
   - 改进了 `pg_upgrade` 对扩展兼容性检查的支持。
   - 允许在 MSVC 编译中启用 GSSAPI 支持，解决了 Kerberos 集成中的兼容性问题。

8. **安全和易用性**  
   - 修复了涉及复制协议和事务准备的安全漏洞。
   - 改进错误信息的表达，使其更直观易懂。

---

PostgreSQL 的每个修复版本都会在官方发布说明中列出所有变更的完整列表，包括安全性修复、功能修复、性能改进以及其他小型优化。

根据官方文档，[PostgreSQL 12.9 的发布说明](https://www.postgresql.org/docs/12/release-12-9.html) 中已经全面列出了该版本的所有修复内容。如果您希望确认是否有遗漏，可以直接对比更新日志与您的实际需求或已知问题。

如果需要进一步验证，建议查看：
1. PostgreSQL 源代码的 [Git Commit 历史](https://git.postgresql.org/gitweb/)。
2. 社区讨论的变更详情（如邮件列表）。
3. PostgreSQL 的 [Bug Tracker](https://www.postgresql.org/community/bugs/) 中提交的修复记录。
